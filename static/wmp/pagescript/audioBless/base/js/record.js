;/*!src/record/main.js*/
Vue.use(VueResource),Vue.http.options.emulateJSON=!0,Vue.use(infiniteScroll);var recordComponent=Vue.extend({template:"#record-btn-temp",data:function(){return{access:!0,holddown:!1,uploadVoice:!1,uploading:!1,localId:0,serverId:0,touchPosition:{startPageY:0,movePageY:0,stopPageY:0},diffPageY:80,touchstartTime:null,recordTime:0,totalTime:28,timer:null}},watch:{hasVoice:function(){this.$emit("showshare",this.hasVoice)},ready:function(){this.ready&&(this.initAudioId&&""!=this.initAudioId?(this.serverId=this.initAudioId,this.downloadVoice(this.serverId)):this.accessRecord(),this.onVoiceRecordEnd())},recordTime:function(t){if(0!==t){if(t===this.totalTime)return void this.stopRecord();var o=this;this.timer=setTimeout(function(){o.recordTime++},1e3)}}},computed:{hasVoice:function(){return 0!==this.localId},touchout:function(){return this.touchPosition.movePageY>0?this.touchPosition.movePageY<this.touchPosition.startPageY-this.diffPageY:!1}},props:["initAudioId","ready"],methods:{accessRecord:function(){var t,o=this;wx.startRecord({success:function(){o.access=!0},cancel:function(){o.access=!1}}),setTimeout(function(){wx.stopRecord({localId:t})},1500)},keydown:function(){this.holddown=!0},keyup:function(){this.holddown=!1},reset:function(){this.stopVoice(),this.localId=0,this.serverId=0},stopVoice:function(){this.holddown&&(wx.stopVoice({localId:this.localId}),this.keyup())},playVoice:function(){if(this.hasVoice&&!this.holddown){this.keydown(),wx.playVoice({localId:this.localId});var t=this;wx.onVoicePlayEnd({success:function(){t.keyup()}})}},resetState:function(){clearTimeout(this.timer),this.recordTime=0;var t=this.touchPosition;for(var o in t)t.hasOwnProperty(o)&&(t[o]=0)},logTouchPageY:function(t,o){this.touchPosition[o]=t.changedTouches[0].pageY},cancelRecord:function(t){this.logTouchPageY(t,"movePageY")},startRecord:function(t){if(!(this.holddown||"object"==typeof this.touchstartTime&&new Date-this.touchstartTime<1e3)){var o=this;wx.startRecord({success:function(){o.resetState(),o.logTouchPageY(t,"startPageY"),o.keydown(),o.recordTime++}}),this.touchstartTime=new Date}},onVoiceRecordEnd:function(){var t=this;wx.onVoiceRecordEnd({complete:function(o){o.localId;t.localId=o.localId,t.keyup(),t.uploaVoice()}})},stopRecord:function(t){if(this.holddown){var o=new Date-this.touchstartTime>1e3,e=o?0:1e3;t&&this.logTouchPageY(t,"stopPageY");var i=this;setTimeout(function(){wx.stopRecord({success:function(t){if(i.keyup(),!i.touchout){if(!o)return void alert("语音过短！");i.localId=t.localId,setTimeout(function(){i.uploaVoice()},0)}}})},e)}},pushData:function(){this.$emit("pushdata",this.serverId)},downloadVoice:function(t){var o=this;wx.downloadVoice({serverId:t,success:function(t){o.localId=t.localId}})},uploaVoice:function(){var t=this;t.uploading=!0,wx.uploadVoice({localId:t.localId,isShowProgressTips:1,success:function(o){t.serverId=o.serverId,t.pushData()}})}},directives:{play:{update:function(t,o){function e(){var o=t.children[1],e=t.children[2];o.style.opacity=0,e.style.opacity=0;var i=t.children,s=0,n=!1;window.playingAnimate=setInterval(function(){n?i[--s].style.opacity=0:i[s++].style.opacity=1,(s===i.length||0===s)&&(n=!n)},200)}function i(){window.clearInterval(window.playingAnimate);for(var o=0;o<t.children.length;o++)t.children[o].style.opacity=1}o.value?e():i()}}},mounted:function(){}});Vue.component("record-btn",recordComponent);var jdListComponent=Vue.extend({template:"#jd-list-temp",data:function(){return{commentList:[],busy:!1,hasMore:!0,totalCount:0,pageNo:1,userCount:0}},methods:{close:function(){this.$emit("closelist")},linkView:function(t,o){return t?"/wmp/user/"+appConfigId+"/audiobless/view/"+o:"javascript:;"},fetchData:function(){if(this.hasMore){var t=this;t.busy=!0,Vue.http.get("/wmp/user/"+appConfigId+"/audiobless/loadEgg?page="+this.pageNo).then(function(o){var e=JSON.parse(o.body);return-1===e.code?void alert(e.msg):(t.commentList=[].concat(t.commentList,e.data.list),t.totalCount=e.data.userCount,t.pageNo=e.data.page+1,t.hasMore=e.data.haveMore,t.busy=!1,void console.log("list fetchData over"))})}}},created:function(){this.fetchData()}});Vue.component("jd-list",jdListComponent);var maskComponent=Vue.extend({template:"#mask-temp",data:function(){return{"switch":!1}},methods:{closelist:function(){console.log("closelist"),this.$emit("close")}}});Vue.component("mask-view",maskComponent);var shareBoardComponent=Vue.extend({template:"#share-board-box-temp"});Vue.component("share-board-box",shareBoardComponent);var app=new Vue({el:".container",data:{jjImgs:jjImgs,jjType:initTemplateId?initTemplateId:1,jjTypeChanging:!1,transitioning:!1,recorded:!1,share:!1,showMask:!1,maskSlotList:{list:"jd-list",share:"share-board-box"},maskSlotName:"",alljdCount:alljdCount,myjdCount:myjdCount,initAudioId:initAudioId?initAudioId:0,wxReady:!1},computed:{currentjjtype:function(){return this.jjImgs[this.jjType-1]}},methods:{showList:function(){0!==this.myjdCount&&(this.maskSlotName=this.maskSlotList.list,this.toggleShowMask())},showShareBox:function(){this.maskSlotName=this.maskSlotList.share,this.toggleShowMask()},toggleShowMask:function(){this.showMask=!this.showMask},changejjType:function(){var t=this;t.jjTypeChanging=!0,t.jjType<t.jjImgs.length?t.jjType++:t.jjType=1,t.pushServer();var o=function(){t.jjTypeChanging=!1};setTimeout(function(){o()},250)},showShare:function(t){this.share=t,t&&wx?wx.showOptionMenu():wx&&wx.hideOptionMenu()},pushServer:function(t){var o={templeteId:this.jjType};t&&(o.audioId=t),Vue.http.post("/wmp/user/"+appConfigId+"/audiobless/postBless",o).then(function(t){t.body;console.info("pushData over")})}},mounted:function(){openList&&this.showList()}});